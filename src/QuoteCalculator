// File: src/QuoteCalculator.js
const [overheadPerHour, setOverheadPerHour] = useState(22.4);
const MIN_HOURS = 3.4;
const [hours, setHours] = useState(MIN_HOURS);


const [materials, setMaterials] = useState({
epoxyPrimer: { ozPerHr: 0.5, costPerOz: 2.5, enabled: true },
epoxyCatalyst: { mixRatio: 0.1, costPerOz: 5, enabled: true },
highBuildPrimer: { ozPerHr: 0.6, costPerOz: 3, enabled: true },
primerActivator: { mixRatio: 0.1, costPerOz: 4, enabled: true },
sealer: { ozPerHr: 0.4, costPerOz: 3.5, enabled: true },
sealerActivator: { mixRatio: 0.1, costPerOz: 4, enabled: true },
reducer: { percent: 0.2, costPerOz: 1.5, enabled: true },
basecoat: { ozPerHr: 1.2, costPerOz: 4.5, enabled: true },
clearcoat: { ozPerHr: 1.8, costPerOz: 2.8, enabled: true },
clearActivator: { mixRatio: 0.1, costPerOz: 4, enabled: true },
flexAdditive: { flatCost: 5, enabled: false },
adhesionPromoter: { flatCost: 6, enabled: false },
});


const billableHours = Math.max(hours, MIN_HOURS);
const minHourlyRate = overheadPerHour / (1 - targetMargin / 100);
const blockHours = [20, 20, 20, 20];
const progressiveRates = blockHours.map((block, i) => {
const totalBlocks = blockHours.length;
const rateReduction = ((baseRate - minHourlyRate) / (totalBlocks - 1)) * i;
return Math.max(baseRate - rateReduction, minHourlyRate);
});


let remainingHours = billableHours;
let laborRevenue = 0;
for (let i = 0; i < blockHours.length; i++) {
const hoursInBlock = Math.min(remainingHours, blockHours[i]);
laborRevenue += hoursInBlock * progressiveRates[i];
remainingHours -= hoursInBlock;
if (remainingHours <= 0) break;
}


let totalMaterialCost = 0;
Object.entries(materials).forEach(([key, mat]) => {
if (mat.enabled) {
if (mat.ozPerHr) totalMaterialCost += mat.ozPerHr * billableHours * mat.costPerOz;
else if (mat.flatCost) totalMaterialCost += mat.flatCost;
}
});


const overheadCost = billableHours * overheadPerHour;
const totalCost = overheadCost + totalMaterialCost;
const totalQuote = laborRevenue + totalMaterialCost;
const profit = totalQuote - totalCost;
const margin = (profit / totalQuote) * 100;


const toggleMaterial = (key) => {
setMaterials(prev => ({ ...prev, [key]: { ...prev[key], enabled: !prev[key] } }));
};


return (
<div style={{ maxWidth: 500, margin: '20px auto', fontFamily: 'sans-serif' }}>
<h1>Mobile Paint Quote Calculator</h1>
<div>
<label>Estimated Labor Hours:</label>
<input type="number" step="0.1" value={hours} onChange={(e) => setHours(parseFloat(e.target.value))} />
<small>Minimum enforced: {MIN_HOURS}</small>
</div>
<div>
<label>Base Hourly Rate:</label>
<input type="number" step="0.1" value={baseRate} onChange={(e) => setBaseRate(parseFloat(e.target.value))} />
</div>
<div>
<label>Target Margin %:</label>
<input type="number" step="1" value={targetMargin} onChange={(e) => setTargetMargin(parseFloat(e.target.value))} />
</div>
<h2>Materials</h2>
{Object.entries(materials).map(([key, mat]) => (
<div key={key}>
<label>
<input type="checkbox" checked={mat.enabled} onChange={() => toggleMaterial(key)} />
{key.replace(/([A-Z])/g, ' $1')}
</label>
</div>
))}
<h2>Quote Output</h2>
<p>Total Quote: ${totalQuote.toFixed(2)}</p>
<p>Estimated Profit: ${profit.toFixed(2)}</p>
<p>Profit Margin: {margin.toFixed(1)}%</p>
<p>Billable Hours: {billableHours.toFixed(1)}</p>
</div>
);
}
